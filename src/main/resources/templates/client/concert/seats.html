<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{admin/fragments/header :: header}"></head>
<style>
    .seat { width: 40px; height: 40px; margin: 5px; border-radius: 5px; cursor: pointer; display: inline-block; line-height: 40px; text-align: center; font-size: 12px; transition: 0.3s; }
    .available { background-color: #e9ecef; border: 1px solid #dee2e6; }
    .available:hover { background-color: #0d6efd; color: white; transform: scale(1.1); }
    .occupied { background-color: #ffc107; cursor: not-allowed; color: white; }
    .sold { background-color: #dc3545; cursor: not-allowed; color: white; }
    .stage { background: #343a40; color: white; padding: 10px; margin-bottom: 50px; border-radius: 0 0 50px 50px; }
</style>
<body>
<div class="container mt-5 text-center">
    <div class="stage shadow-sm">STAGE</div>
    <div class="seat-container mb-5">
        <div th:each="seat : ${seats}"
             th:classappend="${seat.getDisplayStatus() == 'AVAILABLE' ? 'available' :
                     (seat.getDisplayStatus() == 'OCCUPIED' ? 'occupied' : 'sold')}"
             class="seat"
             th:text="${seat.seatNumber}"
             th:onclick="${seat.getDisplayStatus() == 'AVAILABLE'} ? 'occupySeat(' + ${seat.id} + ')' : ''">
        </div>
    </div>
    <div class="d-flex justify-content-center gap-4">
        <div><span class="seat available d-inline-block"></span> 선택 가능</div>
        <div><span class="seat occupied d-inline-block"></span> 선점 중</div>
        <div><span class="seat sold d-inline-block"></span> 판매 완료</div>
    </div>
</div>

<script th:inline="javascript">
    const userId = [[${userId}]];
    const concertId = [[${concertId}]];

    function occupySeat(seatId) {
        fetch(`/api/seats/${seatId}/occupy?userId=${userId}`)
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    window.location.href = `/concerts/${concertId}/payments?seatId=${seatId}&userId=${userId}`;
                } else {
                    alert("이미 다른 사용자가 선택 중인 좌석입니다.");
                    location.reload();
                }
            });
    }
</script>
</body>
</html>