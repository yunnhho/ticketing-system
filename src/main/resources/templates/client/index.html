<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="client/fragment/header :: header"></head>

<body>

<nav class="navbar navbar-expand-lg sticky-top mb-0">
    <div class="container">
        <a class="navbar-brand" href="/concerts">
            <i class="bi bi-ticket-perforated-fill me-1"></i>Ticket Service
        </a>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item">
                    <a class="nav-link active fw-bold" href="/concerts">ê³µì—° ëª©ë¡</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" onclick="alert('ë°ëª¨ ë²„ì „ì…ë‹ˆë‹¤.'); return false;">ë‚´ ì˜ˆë§¤ ë‚´ì—­</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<section class="bg-dark text-white py-5 mb-5" style="background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://source.unsplash.com/1600x900/?concert') center/cover;">
    <div class="container text-center">
        <h1 class="display-4 fw-bold">Find Your Dream Concert</h1>
        <p class="lead mb-4">ì§€ê¸ˆ ë°”ë¡œ ëŒ€ê¸°ì—´ì— ì°¸ì—¬í•˜ê³  ì¢Œì„ì„ ì„ ì í•˜ì„¸ìš”!</p>
        <p id="user-display" class="badge bg-primary fs-6">
        </p>
    </div>
</section>

<div class="container mb-5">
    <div class="d-flex align-items-center justify-content-between mb-4">
        <h3 class="fw-bold mb-0">ğŸ”¥ ì§„í–‰ ì¤‘ì¸ í‹°ì¼“íŒ…</h3>
        <span class="text-muted">í˜„ì¬ ì˜ˆë§¤ ê°€ëŠ¥í•œ ê³µì—°ì…ë‹ˆë‹¤.</span>
    </div>

    <div class="row g-4">
        <div class="col-md-4" th:each="concert : ${concerts}">
            <div class="card concert-card h-100">
                <div class="card-img-top d-flex align-items-center justify-content-center text-secondary" style="background-color: #f1f3f5;">
                    <i class="bi bi-music-note-beamed" style="font-size: 4rem; opacity: 0.3;"></i>
                </div>

                <div class="card-body d-flex flex-column">
                    <h5 class="card-title fw-bold mb-1" th:text="${concert.title}">ê³µì—° ì œëª©</h5>
                    <p class="card-text text-secondary small mb-3">
                        <i class="bi bi-geo-alt-fill me-1 text-primary"></i>
                        <span th:text="${concert.venue}">ì¥ì†Œ</span>
                    </p>

                    <div class="mt-auto">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <span class="badge bg-light text-dark border">
                                Total <span th:text="${concert.totalSeats}">500</span> Seats
                            </span>
                            <span class="text-danger fw-bold small">Selling Fast!</span>
                        </div>

                        <div class="d-grid">
                            <button class="btn btn-primary btn-lg fw-bold"
                                    th:onclick="'startTicketing(' + ${concert.id} + ')'">
                                ì˜ˆë§¤í•˜ê¸° <i class="bi bi-arrow-right-short"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-12 text-center py-5" th:if="${concerts.isEmpty()}">
            <p class="text-muted">í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ê³µì—°ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
    </div>
</div>

<footer class="bg-white py-4 mt-auto border-top">
    <div class="container text-center text-muted small">
        &copy; 2026 Ticket Service. All Rights Reserved.
    </div>
</footer>

<script>
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„ì‹œ ìœ ì € ID ìƒì„± ë˜ëŠ” ë¡œë“œ
    document.addEventListener("DOMContentLoaded", function() {
        let userId = localStorage.getItem("ticketing_demo_user");

        if (!userId) {
            // ëœë¤ ìœ ì € ID ìƒì„± (ì˜ˆ: user_1234)
            userId = "user_" + Math.floor(Math.random() * 100000);
            localStorage.setItem("ticketing_demo_user", userId);
        }

        // ìƒë‹¨ ë°°ë„ˆì— ì ‘ì†ì¤‘ì¸ ID í‘œì‹œ
        const userDisplay = document.getElementById("user-display");
        if(userDisplay) {
            userDisplay.innerText = "ì ‘ì† ID: " + userId;
        }
    });

    // ì˜ˆë§¤ ë²„íŠ¼ í´ë¦­ ì‹œ í˜¸ì¶œ
    function startTicketing(concertId) {
        const userId = localStorage.getItem("ticketing_demo_user");
        if (!userId) {
            alert("ìœ ì € ì •ë³´ë¥¼ ë¡œë“œí•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.");
            return;
        }

        // ì»¨íŠ¸ë¡¤ëŸ¬ ë¡œì§ì— ë§ì¶° íŒŒë¼ë¯¸í„° ì „ë‹¬ (/concerts/{id}/wait?userId=...)
        window.location.href = `/concerts/${concertId}/wait?userId=${userId}`;
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>